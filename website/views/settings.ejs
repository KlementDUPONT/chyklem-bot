<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - <%= guild.name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --sidebar-width: 280px; --bg-dark: #1a1c1e; --bg-card: #2b2d31; --accent: #5865F2; }
        body { background-color: var(--bg-dark); color: #dbdee1; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }
        
        /* Sidebar */
        .sidebar { position: fixed; top: 0; left: 0; height: 100vh; width: var(--sidebar-width); background: #111214; padding: 20px; border-right: 1px solid #1e1f22; }
        .sidebar-header img { width: 50px; height: 50px; border-radius: 50%; }
        .nav-link { color: #949ba4; padding: 12px 15px; border-radius: 5px; margin-bottom: 5px; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { background-color: #35373c; color: white; }
        .nav-link i { width: 25px; }

        /* Contenu Principal */
        .main-content { margin-left: var(--sidebar-width); padding: 40px; }
        .section-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #3f4147; padding-bottom: 10px; }
        
        /* Cartes MEE6 Style */
        .config-card { background-color: var(--bg-card); border-radius: 8px; padding: 25px; margin-bottom: 30px; border: 1px solid #1e1f22; }
        .form-label { font-weight: 600; color: #f2f3f5; }
        .form-control, .form-select { background-color: #1e1f22; border: 1px solid #111214; color: white; padding: 10px; }
        .form-control:focus, .form-select:focus { background-color: #1e1f22; color: white; border-color: var(--accent); box-shadow: none; }
        
        /* Switch iOS Style */
        .form-switch .form-check-input { width: 3em; height: 1.5em; background-color: #4e5058; border: none; }
        .form-switch .form-check-input:checked { background-color: #23a559; }

        /* Preview Bienvenue */
        .preview-box {
            position: relative; width: 100%; height: 200px; border-radius: 10px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            background-size: cover; background-position: center; border: 2px solid #5865F2;
        }
        .preview-overlay { background: rgba(0,0,0,0.4); padding: 20px; border-radius: 10px; text-align: center; width: 90%; }
        .preview-text { font-size: 24px; font-weight: bold; }
        .preview-sub { font-size: 18px; }

        .btn-save { position: fixed; bottom: 30px; right: 30px; background-color: #23a559; color: white; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: none; transition: transform 0.2s; z-index: 100; }
        .btn-save:hover { transform: scale(1.05); background-color: #1f914e; color: white;}
    </style>
</head>
<body>

    <div class="sidebar d-flex flex-column">
        <div class="sidebar-header d-flex align-items-center mb-5">
            <% if (guild.icon) { %>
                <img src="https://cdn.discordapp.com/icons/<%= guild.id %>/<%= guild.icon %>.png" alt="Icon">
            <% } else { %>
                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold" style="width:50px;height:50px"><%= guild.name.charAt(0) %></div>
            <% } %>
            <div class="ms-3">
                <div class="fw-bold text-white text-truncate" style="max-width: 150px;"><%= guild.name %></div>
                <a href="/dashboard" class="text-muted small text-decoration-none">Changer de serveur</a>
            </div>
        </div>

        <nav class="nav flex-column">
            <a class="nav-link active" href="#welcome"><i class="fas fa-door-open"></i> Bienvenue</a>
            <a class="nav-link" href="#moderation"><i class="fas fa-gavel"></i> Mod√©ration & Logs</a>
            <a class="nav-link" href="#security"><i class="fas fa-shield-alt"></i> S√©curit√©</a>
        </nav>
        
        <div class="mt-auto text-muted small">
            Powered by ChyKlem Bot
        </div>
    </div>

    <div class="main-content">
        <% if (success) { %>
            <div class="alert alert-success position-fixed top-0 end-0 m-4" style="z-index: 1050;" id="successAlert">
                <i class="fas fa-check-circle me-2"></i> Modifications sauvegard√©es !
            </div>
            <script>setTimeout(() => document.getElementById('successAlert').style.display = 'none', 3000);</script>
        <% } %>

        <form action="/settings/<%= guild.id %>" method="POST">
            
            <div id="welcome">
                <div class="section-title">üëã Module de Bienvenue</div>
                
                <div class="config-card">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Salon d'arriv√©e</label>
                            <select name="welcome_channel_id" class="form-select mb-3">
                                <option value="">üî¥ D√©sactiv√©</option>
                                <% channels.forEach(channel => { %>
                                    <% if (channel.type === 0) { %>
                                        <option value="<%= channel.id %>" <%= settings.welcome_channel_id === channel.id ? 'selected' : '' %>># <%= channel.name %></option>
                                    <% } %>
                                <% }) %>
                            </select>

                            <label class="form-label">Image de Fond (URL)</label>
                            <input type="text" class="form-control mb-3" name="welcome_bg" id="bgInput" 
                                   value="<%= settings.welcome_bg || 'https://i.imgur.com/vH1W4Qc.jpeg' %>" 
                                   placeholder="https://imgur.com/...">
                            
                            <label class="form-label">Couleur du Texte</label>
                            <input type="color" class="form-control form-control-color w-100" name="welcome_color" id="colorInput" 
                                   value="<%= settings.welcome_color || '#ffffff' %>">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Aper√ßu en direct</label>
                            <div class="preview-box" id="previewBox">
                                <div class="preview-overlay">
                                    <div class="preview-text" id="previewTitle">BIENVENUE</div>
                                    <div class="preview-sub" id="previewUser"><%= user.username.toUpperCase() %></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-card">
                    <label class="form-label">R√¥le Automatique (Auto-Role)</label>
                    <select name="autorole_id" class="form-select">
                        <option value="">-- Aucun r√¥le --</option>
                        <% roles.forEach(role => { %>
                            <% if (role.name !== '@everyone' && !role.managed) { %>
                                <option value="<%= role.id %>" <%= settings.autorole_id === role.id ? 'selected' : '' %>>@<%= role.name %></option>
                            <% } %>
                        <% }) %>
                    </select>
                    <div class="form-text text-muted">Ce r√¥le sera donn√© imm√©diatement aux nouveaux arrivants.</div>
                </div>
            </div>

            <div id="moderation" class="mt-5">
                <div class="section-title">‚öñÔ∏è Mod√©ration & Logs</div>
                <div class="config-card">
                    <label class="form-label">Salon de Logs</label>
                    <select name="log_channel_id" class="form-select">
                        <option value="">üî¥ D√©sactiv√©</option>
                        <% channels.forEach(channel => { %>
                            <% if (channel.type === 0) { %>
                                <option value="<%= channel.id %>" <%= settings.log_channel_id === channel.id ? 'selected' : '' %>># <%= channel.name %></option>
                            <% } %>
                        <% }) %>
                    </select>
                    <div class="mt-3 text-muted small">
                        <i class="fas fa-info-circle"></i> Le bot enregistrera ici les messages supprim√©s, modifi√©s et les signalements.
                    </div>
                </div>
            </div>

            <div id="security" class="mt-5">
                <div class="section-title">üõ°Ô∏è S√©curit√© Anti-Raid</div>
                <div class="config-card d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-1">Activer le bouclier Anti-Raid</h5>
                        <div class="text-muted">Expulse automatiquement les comptes trop r√©cents.</div>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="antiraid_enabled" <%= settings.antiraid_enabled ? 'checked' : '' %>>
                    </div>
                </div>

                <div class="config-card">
                    <label class="form-label">√Çge minimum du compte (en jours)</label>
                    <input type="number" name="antiraid_days" class="form-control" value="<%= settings.antiraid_account_age_days || 7 %>" min="1" max="30">
                </div>
            </div>

            <button type="submit" class="btn-save">
                <i class="fas fa-save me-2"></i> Sauvegarder
            </button>

        </form>
    </div>

    <script>
        const bgInput = document.getElementById('bgInput');
        const colorInput = document.getElementById('colorInput');
        const previewBox = document.getElementById('previewBox');
        const previewTitle = document.getElementById('previewTitle');
        const previewUser = document.getElementById('previewUser');

        function updatePreview() {
            // Change le fond
            previewBox.style.backgroundImage = `url('${bgInput.value}')`;
            // Change la couleur
            previewTitle.style.color = colorInput.value;
            previewUser.style.color = colorInput.value;
        }

        // √âcoute les changements
        bgInput.addEventListener('input', updatePreview);
        colorInput.addEventListener('input', updatePreview);
        
        // Lance au chargement
        updatePreview();
    </script>
</body>
</html>